<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ZalxZhu - Development Hub</title>
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/rhamt24/zalxzhu.github.io/images/f1e63c4922f7d0b0fc4cf9f7b30cef45.jpg" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --pink-sakura: #ffc2cd; /* Lebih cerah */
      --pink-glow: rgba(255, 183, 197, 0.6);
      --glass: rgba(25, 25, 25, 0.85); /* Sedikit lebih terang dari sebelumnya */
      --glass-border: rgba(255, 255, 255, 0.2);
      --wa-green: #2ecc71;
      --online: #00ff88;
      --offline: #ff4757;
      --bg-dark: #0a0a0c; /* Tidak hitam pekat agar dimensi terlihat */
    }

    * { 
      box-sizing: border-box; 
      -webkit-tap-highlight-color: transparent;
      outline: none;
    }
    
    body, html {
      margin: 0; padding: 0;
      font-family: 'Poppins', sans-serif;
      color: #fff; 
      background-color: var(--bg-dark);
      overflow: hidden; 
      height: 100%; width: 100%;
      /* GPU Acceleration Trigger */
      transform: translateZ(0);
    }

    /* ===============================
       ðŸŒ¸ DYNAMIC GRID BACKGROUND (GPU OPTIMIZED)
       =============================== */
    .dynamic-grid {
      position: fixed;
      inset: -100px; 
      background-image:
        linear-gradient(rgba(255,183,197,0.2) 1.5px, transparent 1.5px),
        linear-gradient(90deg, rgba(255,183,197,0.2) 1.5px, transparent 1.5px);
      background-size: 55px 55px;
      animation: gridMove 25s linear infinite;
      transform: perspective(1000px) rotateX(25deg) translateZ(0);
      transform-origin: center;
      z-index: 0;
      pointer-events: none;
      will-change: transform; /* Hint for GPU */
    }

    @keyframes gridMove {
      from { transform: perspective(1000px) rotateX(25deg) translateY(0); }
      to { transform: perspective(1000px) rotateX(25deg) translateY(55px); }
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(
        circle at center,
        rgba(255, 183, 197, 0.05) 0%,
        rgba(0,0,0,0.7) 100%
      );
      z-index: 1;
      pointer-events: none;
    }

    /* --- MUSIC POPUP PLAYER --- */
    #music-popup {
      position: fixed; top: 100px; right: 20px;
      width: 280px; 
      background: var(--glass);
      backdrop-filter: blur(25px); 
      -webkit-backdrop-filter: blur(25px);
      border-radius: 20px;
      border: 1px solid var(--glass-border); 
      z-index: 4000;
      padding: 12px; 
      box-shadow: 0 15px 45px rgba(0,0,0,0.7), 0 0 20px rgba(255,183,197,0.1);
      transition: opacity 0.4s, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      display: flex; flex-direction: column; gap: 8px;
      touch-action: none;
      will-change: transform;
    }
    
    .hide-btn {
      position: absolute; top: -10px; right: -8px;
      width: 26px; height: 26px; background: var(--pink-sakura);
      color: #000; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; cursor: pointer; z-index: 10;
      box-shadow: 0 0 15px var(--pink-glow);
    }

    .player-info { display: flex; gap: 12px; align-items: center; pointer-events: none; }
    .song-cover { 
      width: 55px; height: 55px; border-radius: 12px; 
      object-fit: cover; border: 1.5px solid var(--pink-sakura); 
      flex-shrink: 0; transition: 0.4s; 
    }
    .song-details { overflow: hidden; flex: 1; display: flex; flex-direction: column; justify-content: center; }
    .song-title { font-size: 12px; font-weight: 600; color: var(--pink-sakura); margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .song-author { font-size: 10px; color: #ddd; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    .player-controls { display: flex; align-items: center; gap: 10px; z-index: 11; }
    .play-btn {
      background: var(--pink-sakura); border: none; width: 38px; height: 38px;
      border-radius: 50%; color: #111; cursor: pointer; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      transition: transform 0.2s;
    }
    .play-btn:active { transform: scale(0.9); }
    
    .progress-box { flex-grow: 1; display: flex; flex-direction: column; gap: 4px; pointer-events: auto; }
    .progress-bar-container { width: 100%; height: 5px; background: rgba(255,255,255,0.1); border-radius: 10px; position: relative; cursor: pointer; }
    #progress-fill { position: absolute; left: 0; top: 0; height: 100%; background: var(--pink-sakura); width: 0%; border-radius: 10px; box-shadow: 0 0 8px var(--pink-glow); }
    .time-info { display: flex; justify-content: space-between; font-size: 9px; color: #aaa; font-family: monospace; margin-top: 2px; }
    
    input[type=range] { -webkit-appearance: none; width: 60px; background: transparent; cursor: pointer; }
    input[type=range]::-webkit-slider-runnable-track { height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; }
    input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 14px; width: 14px; background: var(--pink-sakura); border-radius: 50%; margin-top: -5px; box-shadow: 0 0 8px var(--pink-glow); }

    #music-popup.minimized {
      width: 65px; height: 65px; padding: 0; border-radius: 50%; 
      overflow: hidden; cursor: grab; border: 2.5px solid var(--pink-sakura);
      background: rgba(0,0,0,0.85); justify-content: center; align-items: center;
      box-shadow: 0 0 25px var(--pink-glow);
    }
    #music-popup.minimized .hide-btn, #music-popup.minimized .song-details, #music-popup.minimized .player-controls { display: none !important; }
    #music-popup.minimized .song-cover { width: 100%; height: 100%; border-radius: 50% !important; border: none; animation: spinVinyl 5s linear infinite; }
    @keyframes spinVinyl { 100% { transform: rotate(360deg); } }
    
    /* --- CONTAINER LAYOUT --- */
    .container { 
      max-width: 480px; margin: auto; padding: 40px 20px 0; 
      display: none; height: 100vh; flex-direction: column; 
      will-change: opacity, transform;
    }
    .container.active { display: flex; animation: slideUp 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

    .bottom-nav {
      position: fixed; bottom: 25px; left: 50%;
      transform: translateX(-50%) translateZ(0);
      width: 92%; max-width: 450px;
      background: rgba(30, 30, 30, 0.8);
      backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
      border: 1px solid var(--glass-border);
      border-radius: 35px;
      display: flex; justify-content: space-around;
      padding: 12px 5px; z-index: 2000;
      box-shadow: 0 15px 35px rgba(0,0,0,0.6);
    }
    .nav-item { color: #888; font-size: 18px; cursor: pointer; transition: 0.4s; display: flex; flex-direction: column; align-items: center; flex: 1; }
    .nav-item.active { color: var(--pink-sakura); transform: translateY(-8px); text-shadow: 0 0 12px var(--pink-glow); }
    .nav-item span { font-size: 8px; margin-top: 5px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }

    .profile-header { text-align: center; margin-bottom: 25px; flex-shrink: 0; }
    .profile-pic { width: 100px; height: 100px; border-radius: 50%; border: 3.5px solid var(--pink-sakura); margin-bottom: 12px; box-shadow: 0 0 20px var(--pink-glow); object-fit: cover; }
    h1 { font-size: 24px; margin: 0; letter-spacing: 1.5px; font-weight: 600; background: linear-gradient(to bottom, #fff, #ffb7c5); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .username-link { color: #ccc; text-decoration: none; font-size: 13px; display: block; margin-top: 4px; opacity: 0.8; }

    .scroll-area { overflow-y: auto; flex-grow: 1; padding-bottom: 160px; -webkit-overflow-scrolling: touch; scroll-behavior: smooth; }
    .scroll-area::-webkit-scrollbar { width: 0; }

    .card { 
      background: rgba(255, 255, 255, 0.07); 
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border); 
      border-radius: 22px; padding: 20px; margin-bottom: 18px; 
      transition: 0.3s;
    }
    .card:active { transform: scale(0.98); background: rgba(255, 255, 255, 0.12); }
    
    .link-item { text-decoration: none; color: white; display: flex; align-items: center; justify-content: space-between; }
    .wa-color { color: var(--wa-green) !important; font-weight: 600; }
    .pink-color { color: var(--pink-sakura) !important; }

    .bot-thumb, .news-media, .placeholder-thumb { width: 100%; border-radius: 15px; object-fit: cover; margin-bottom: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    .bot-thumb, .placeholder-thumb { height: 190px; }
    .news-date { font-size: 10px; color: #888; display: block; margin-top: 10px; font-weight: 500; }
    
    .retired-label { background: rgba(255, 71, 87, 0.2); color: #ff4757; border: 1.5px solid #ff4757; padding: 4px 12px; border-radius: 8px; font-size: 10px; font-weight: 800; margin-bottom: 10px; display: inline-block; }
    
    .btn-main { 
      width: 100%; background: var(--pink-sakura); border: none; padding: 14px; 
      border-radius: 15px; color: #111; font-weight: 700; cursor: pointer; 
      box-shadow: 0 4px 15px var(--pink-glow); transition: 0.3s;
    }
    .btn-main:hover { transform: translateY(-2px); box-shadow: 0 6px 20px var(--pink-glow); }

    .status-indicator { display: flex; align-items: center; gap: 12px; font-size: 14px; font-weight: 600; margin-top: 12px; }
    .dot { width: 12px; height: 12px; border-radius: 50%; }
    .dot-online { background: var(--online); box-shadow: 0 0 15px var(--online); animation: pulse 1.5s infinite; }
    .dot-offline { background: var(--offline); box-shadow: 0 0 10px var(--offline); }
    @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.3); opacity: 0.5; } 100% { transform: scale(1); opacity: 1; } }

    .giscus-container { flex-grow: 1; overflow-y: auto; padding-bottom: 180px; }

    #qris-modal { 
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      background: rgba(0,0,0,0.95); z-index: 5000; align-items: center; 
      justify-content: center; flex-direction: column; 
      backdrop-filter: blur(10px);
    }
    .qris-box { background: white; padding: 20px; border-radius: 30px; text-align: center; width: 320px; transform: scale(0.9); animation: modalIn 0.4s forwards; }
    @keyframes modalIn { to { transform: scale(1); } }
    .qris-box img { width: 100%; border-radius: 20px; }
  </style>
</head>
<body onclick="startAudioOnce()">

  <div class="dynamic-grid"></div>
  <div class="overlay"></div>

  <div id="music-popup" class="minimized dock-right">
    <div class="hide-btn" onclick="toggleMinimize(event)"><i class="fas fa-minus"></i></div>
    <div class="player-info">
      <img src="https://i.scdn.co/image/ab67616d0000b273df8d4f8cd143232b98c92552" class="song-cover" id="popup-cover" alt="Cover">
      <div class="song-details">
        <p class="song-title">MoeChakkaFire</p>
        <p class="song-author">ã‚¨ãƒ¬ãƒ³ãƒ»ã‚¸ãƒ§ãƒ¼ (CV:è‹¥å±±è©©éŸ³)</p>
      </div>
    </div>
    <div class="player-controls">
      <button class="play-btn" id="music-btn" onclick="toggleMusic(event)"><i class="fas fa-play"></i></button>
      <div class="progress-box">
        <div class="progress-bar-container" onclick="seekAudio(event)"><div id="progress-fill"></div></div>
        <div class="time-info"><span id="time-current">0:00</span><span id="time-duration">0:00</span></div>
      </div>
      <input type="range" min="0" max="1" step="0.01" value="0.25" oninput="changeVolume(this.value)" onclick="event.stopPropagation()">
    </div>
  </div>

  <div id="home" class="container active">
    <div class="profile-header">
      <img src="https://files.catbox.moe/cbivjy.jpg" class="profile-pic" alt="ZalxZhu">
      <h1>ZalxZhu</h1>
      <p style="color:var(--pink-sakura); font-size: 13px; margin: 5px 0 0; font-weight: 600; letter-spacing: 0.5px;">Project Zhu & Haruka Development</p>
      <a href="https://www.facebook.com/share/1Zyhm8Fxaf/" target="_blank" class="username-link">@zals_cihuy</a>
    </div>
    <div class="scroll-area">
      <div class="card"><p style="font-size: 13px; color: #eee; margin: 0; line-height: 1.7; text-align: center; font-weight: 300;">Welcome to my development hub. Menjelajahi dunia automasi WhatsApp dengan sentuhan AI untuk masa depan yang lebih efisien.</p></div>
      <div class="card"><a href="https://github.com/rhamt24" class="link-item"><span><i class="fab fa-github pink-color"></i> GitHub Profile</span><i class="fas fa-chevron-right" style="opacity: 0.5; font-size: 12px;"></i></a></div>
      <div class="card"><a href="https://whatsapp.com/channel/0029VaYuIQT2v1IjZmqTNG3x" class="link-item"><span class="wa-color"><i class="fab fa-whatsapp"></i> WhatsApp Channel</span><i class="fas fa-external-link-alt" style="font-size: 12px;"></i></a></div>
      <div class="card" onclick="toggleQRIS()" style="cursor: pointer; border: 1.5px dashed var(--pink-sakura); background: rgba(255, 183, 197, 0.05);"><div class="link-item"><span><i class="fas fa-qrcode pink-color"></i> Support via QRIS</span><i class="fas fa-heart pink-color" style="font-size: 12px;"></i></div></div>
    </div>
  </div>

  <div id="news" class="container">
    <h2 style="text-align: center; color: var(--pink-sakura); margin-bottom: 25px;"><i class="fas fa-newspaper"></i> News Update</h2>
    <div class="scroll-area" id="news-container"><div class="loading-news" style="text-align: center; color: #888;">Memuat berita terbaru...</div></div>
  </div>

  <div id="bot" class="container">
    <h2 style="text-align: center; color: var(--pink-sakura); margin-bottom: 25px;"><i class="fas fa-robot"></i> Bot Projects</h2>
    <div class="scroll-area">
      <div class="card">
        <img src="https://files.catbox.moe/xbasea.jpg" class="bot-thumb" alt="Haruka">
        <h3>Haruka Bot</h3>
        <p style="font-size: 12px; color: #ddd; line-height: 1.7;">Era baru pengembangan bot WhatsApp yang lebih cerdas, responsif, dan stabil. Masa depan automasi ada di sini.</p>
        <button class="btn-main" onclick="window.open('https://wa.me/62857586452296?text=.menu', '_blank')">Hubungi Haruka</button>
      </div>
      <div class="card" style="opacity: 0.8; border-color: rgba(255,255,255,0.05);">
        <span class="retired-label">RETIRED / LEGACY</span>
        <img src="https://files.catbox.moe/fhk5mo.jpg" class="bot-thumb" style="filter: grayscale(0.8);" alt="Zhu">
        <h3>Zhu desu</h3>
        <p style="font-size: 12px; color: #bbb; line-height: 1.7;">Zhu telah resmi <b>pensiun</b>. Hadir di sini sebagai <b>pengingat perjuangan masa lalu</b> yang telah membentuk pondasi kokoh untuk pengembangan project selanjutnya.</p>
      </div>
    </div>
  </div>

  <div id="status" class="container">
    <h2 style="text-align: center; color: var(--pink-sakura); margin-bottom: 25px;"><i class="fas fa-signal"></i> System Status</h2>
    <div class="scroll-area">
        <div class="card">
            <h3>Haruka Bot Beta</h3>
            <p style="font-size: 11px; color: #aaa;">Status sistem haruka beta.</p>
            <div class="status-indicator">
                <div id="dot-beta" class="dot dot-offline"></div>
                <span id="text-beta">OFFLINE</span>
            </div>
            <p id="time-beta" style="font-size: 9px; color: #777; margin-top: 8px;">Last Update: -</p>
        </div>
        <div class="card">
            <h3>Haruka Stable Version</h3>
            <p style="font-size: 11px; color: #aaa;">Status sistem haruka versi publik yang stabil.</p>
            <div class="status-indicator">
                <div id="dot-stable" class="dot dot-offline"></div>
                <span id="text-stable">OFFLINE</span>
            </div>
            <p id="time-stable" style="font-size: 9px; color: #777; margin-top: 8px;">Last Update: -</p>
        </div>
    </div>
  </div>

  <div id="other" class="container">
    <h2 style="text-align: center; color: var(--pink-sakura); margin-bottom: 25px;"><i class="fas fa-cubes"></i> Other Projects</h2>
    <div class="scroll-area">
      <div class="card">
        <img src="https://files.catbox.moe/cbivjy.jpg" class="placeholder-thumb" alt="Placeholder">
        <h3 style="text-align: center;">Empty</h3>
        <p style="font-size: 12px; color: #ccc; line-height: 1.6; text-align: center;">Belum ada proyek lain untuk saat ini. Nantikan pembaruan selanjutnya!</p>
      </div>
    </div>
  </div>

  <div id="feedback" class="container">
    <h2 style="text-align: center; color: var(--pink-sakura); margin: 0 0 20px; flex-shrink: 0;"><i class="fas fa-comments"></i> Discussion Column</h2>
    <div class="giscus-container">
        <script src="https://giscus.app/client.js"
                data-repo="rhamt24/zalxzhu.my.id"
                data-repo-id="R_kgDOPIa_rg"
                data-category="General"
                data-category-id="DIC_kwDOPIa_rs4C1LCD"
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="1"
                data-emit-metadata="1"
                data-input-position="top"
                data-theme="transparent_dark"
                data-lang="id"
                async>
        </script>
    </div>
  </div>

  <div id="qris-modal">
    <div class="qris-box">
      <h3 style="color:#333; margin:0 0 12px; font-weight:600;">ZalxZhu QRIS</h3>
      <img src="https://files.catbox.moe/baxxkp.jpg" alt="QRIS">
      <p style="color:#666; font-size:11px; margin-top:12px; line-height:1.4;">Terima kasih atas apresiasinya!</p>
    </div>
    <div onclick="toggleQRIS()" style="margin-top:25px; background:var(--pink-sakura); color:#111; padding:12px 40px; border-radius:18px; cursor:pointer; font-weight:700; box-shadow: 0 5px 20px var(--pink-glow);">Kembali</div>
  </div>

  <nav class="bottom-nav">
    <div class="nav-item active" onclick="showPage('home')"><i class="fas fa-home"></i><span>Home</span></div>
    <div class="nav-item" onclick="showPage('news')"><i class="fas fa-newspaper"></i><span>News</span></div>
    <div class="nav-item" onclick="showPage('bot')"><i class="fas fa-robot"></i><span>Bot</span></div>
    <div class="nav-item" onclick="showPage('status')"><i class="fas fa-signal"></i><span>Status</span></div>
    <div class="nav-item" onclick="showPage('other')"><i class="fas fa-cubes"></i><span>Other</span></div>
    <div class="nav-item" onclick="showPage('feedback')"><i class="fas fa-comments"></i><span>Review</span></div>
  </nav>

  <audio id="bg-music" src="https://cdn.jsdelivr.net/gh/rhamt24/zalxzhu.github.io/mp3/ellen.mp3" loop></audio>

  <script>
    // --- KONFIGURASI ---
    const GIST_BETA_ID = '1ef7200e37a98c6e729d056f000ed8a3';
    const GIST_STABLE_ID = 'a70d87033393fa250438e6896603a9c5'; 
    const _supabaseUrl = 'https://omquwluqxmixiqdmwkir.supabase.co';
    const _supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9tcXV3bHVxeG1peGlxZG13a2lyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4OTE3MzUsImV4cCI6MjA4NDQ2NzczNX0.nVQhgPBzhWgpT1aELHx95MDv7qQcErtDs3C-5pB9qRQ';
    const _supabase = supabase.createClient(_supabaseUrl, _supabaseKey);

    // --- STATUS CHECKER (MODIFIED FOR VERCEL API PROXY) ---
    async function checkBotStatus(gistId, dotId, textId, timeId) {
        const dot = document.getElementById(dotId);
        const text = document.getElementById(textId);
        const time = document.getElementById(timeId);
        if(!dot || !text || !time) return;
        try {
            // SAYA UBAH BARIS INI: Mengarah ke API Vercel buatan kita, bukan Gist langsung
            // Ini untuk menghindari Error 403 (Rate Limit) dan lebih aman
            const res = await fetch(`/api/status?id=${gistId}`);
            
            if (!res.ok) throw new Error(`API Error: ${res.status}`);
            
            const data = await res.json();
            
            // Cek data lebih teliti
            if (!data || !data.files || !data.files['status.json']) {
                console.warn(`File status.json tidak ditemukan.`);
                return;
            }

            const content = JSON.parse(data.files['status.json'].content);
            const lastUpdate = content.last_update;
            const now = Date.now();
            
            // Logic Online: Update < 2 Menit yang lalu
            const isOnline = (now - lastUpdate) < 120000;
            
            if (isOnline) {
                dot.className = 'dot dot-online';
                text.innerText = 'ONLINE';
                text.style.color = 'var(--online)';
            } else {
                dot.className = 'dot dot-offline';
                text.innerText = 'OFFLINE';
                text.style.color = 'var(--offline)';
            }
            time.innerText = `Last Update: ${new Date(lastUpdate).toLocaleString('id-ID')}`;
        } catch (e) { 
             console.log(`Status Check Error (${textId}):`, e.message);
        }
    }
    
    function runStatusCheck() { 
        checkBotStatus(GIST_BETA_ID, 'dot-beta', 'text-beta', 'time-beta'); 
        checkBotStatus(GIST_STABLE_ID, 'dot-stable', 'text-stable', 'time-stable'); 
    }
    
    setInterval(runStatusCheck, 60000);
    runStatusCheck();

    // --- MUSIC PLAYER LOGIC ---
    const music = document.getElementById('bg-music');
    const musicBtn = document.getElementById('music-btn');
    const popup = document.getElementById('music-popup');
    const progressFill = document.getElementById('progress-fill');
    
    function formatTime(s) { if(isNaN(s)) return "0:00"; const m = Math.floor(s/60); const sec = Math.floor(s%60); return `${m}:${sec<10?'0':''}${sec}`; }
    
    music.addEventListener('timeupdate', () => {
      if(!music.duration) return;
      progressFill.style.width = `${(music.currentTime / music.duration) * 100}%`;
      document.getElementById('time-current').innerText = formatTime(music.currentTime);
      document.getElementById('time-duration').innerText = formatTime(music.duration);
    });

    function toggleMusic(e) {
      if(e) e.stopPropagation();
      if(music.paused) { music.play(); musicBtn.innerHTML = '<i class="fas fa-pause"></i>'; popup.classList.remove('paused'); }
      else { music.pause(); musicBtn.innerHTML = '<i class="fas fa-play"></i>'; popup.classList.add('paused'); }
    }

    function changeVolume(val) { music.volume = val; }
    function seekAudio(e) { 
        const rect = e.currentTarget.getBoundingClientRect(); 
        music.currentTime = ((e.clientX - rect.left) / rect.width) * music.duration; 
    }

    function startAudioOnce() { 
        if(music.paused) { 
            music.volume = 0.25; 
            music.play().then(() => { 
                musicBtn.innerHTML = '<i class="fas fa-pause"></i>'; 
                popup.classList.remove('paused');
            }).catch(()=>{}); 
        } 
    }

    let isMinimized = true;
    function toggleMinimize(e) {
      if(e) e.stopPropagation();
      isMinimized = !isMinimized;
      if(isMinimized) {
        popup.classList.add('minimized');
        popup.style.left = "";
        popup.style.top = "";
      } else {
        popup.classList.remove('minimized', 'dock-left', 'dock-right');
      }
    }

    // --- DRAGGABLE LOGIC ---
    let isDragging = false;
    let offset = [0, 0];
    let startPos = [0, 0];

    function onStart(e) {
        if (e.target.closest('button') || e.target.closest('input') || e.target.closest('.hide-btn')) return;
        isDragging = true;
        popup.style.transition = "none";
        const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
        const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
        const rect = popup.getBoundingClientRect();
        offset = [clientX - rect.left, clientY - rect.top];
        startPos = [clientX, clientY];
    }

    function onMove(e) {
        if (!isDragging) return;
        const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
        const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
        if (Math.abs(clientX - startPos[0]) > 5 || Math.abs(clientY - startPos[1]) > 5) {
            e.preventDefault(); 
            popup.style.left = (clientX - offset[0]) + 'px';
            popup.style.top = (clientY - offset[1]) + 'px';
            popup.style.right = 'auto';
        }
    }

    function onEnd() {
        if (!isDragging) return;
        isDragging = false;
        popup.style.transition = "all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
        if (isMinimized) {
            const rect = popup.getBoundingClientRect();
            if (rect.left + rect.width / 2 < window.innerWidth / 2) {
                popup.style.left = "15px"; popup.style.right = "auto";
            } else {
                popup.style.left = "auto"; popup.style.right = "15px";
            }
        }
    }

    popup.addEventListener('mousedown', onStart);
    popup.addEventListener('touchstart', onStart, { passive: true });
    window.addEventListener('mousemove', onMove);
    window.addEventListener('touchmove', onMove, { passive: false });
    window.addEventListener('mouseup', onEnd);
    window.addEventListener('touchend', onEnd);

    popup.addEventListener('click', (e) => {
        if (isMinimized && !isDragging && !e.target.closest('.hide-btn')) {
            const clientX = e.clientX;
            if (Math.abs(clientX - (startPos[0] || 0)) < 10) toggleMinimize(e);
        }
    });

    // --- NEWS FETCHER ---
    async function loadNewsData() {
        const container = document.getElementById('news-container');
        if(!container) return;
        const { data, error } = await _supabase.from('news').select('*').order('created_at', { ascending: false });
        if (error) { container.innerHTML = `<div class="card">Error: ${error.message}</div>`; return; }
        if (!data.length) { container.innerHTML = `<div class="card" style="text-align:center;">Belum ada berita.</div>`; return; }
        container.innerHTML = ''; 
        data.forEach(item => {
            const card = document.createElement('div'); card.className = 'card';
            let mediaHtml = '';
            if (item.media_url) {
                mediaHtml = item.type === 'video' 
                  ? `<video src="${item.media_url}" class="news-media" controls></video>`
                  : `<img src="${item.media_url}" class="news-media" alt="${item.title}">`;
            }
            card.innerHTML = `
                ${mediaHtml}
                <h3 style="margin:0; color:var(--pink-sakura);">${item.title}</h3>
                <p style="font-size:12px; color:#ddd; line-height:1.7; margin-top:10px;">${item.content}</p>
                <span class="news-date">${new Date(item.created_at).toLocaleDateString('id-ID', {day:'numeric', month:'long', year:'numeric'})}</span>
            `;
            container.appendChild(card);
        });
    }

    // --- NAVIGASI HALAMAN ---
    function showPage(pageId) {
      document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      const target = document.getElementById(pageId);
      if(target) target.classList.add('active');
      const nav = Array.from(document.querySelectorAll('.nav-item')).find(i => i.getAttribute('onclick').includes(`'${pageId}'`));
      if (nav) nav.classList.add('active');
      if (pageId === 'news') loadNewsData();
    }
    function toggleQRIS() { const modal = document.getElementById('qris-modal'); modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex'; }
  </script>
</body>
</html>
